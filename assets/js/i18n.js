const locales = {
    'en': {
        "meta": {
            "title": "Global Link Strategy - Your Capital Market Success Partner",
            "description": "Professional listing consultation, M&A, and corporate finance services."
        },
        "nav": {
            "home": "Home",
            "services": "Services",
            "consultants": "Consultants",
            "about": "About Us",
            "contact": "Contact Us",
            "logo_alt": "Global Link Strategy Limited Logo"
        },
        "hero": {
            "title_cn": "Global Link Strategy Limited",
            "title_en": "GLOBAL LINK STRATEGY LIMITED",
            "subtitle": "Your Capital Market Success Partner | IPO Consultation | Corporate Finance",
            "cta": "Book Consultation"
        },
        "services": {
            "title": "Professional Services",
            "subtitle": "Comprehensive Capital Market Solutions",
            "items": [
                {
                    "title": "IPO Consultation",
                    "desc": "Providing full IPO guidance, assisting companies in meeting HKEX listing requirements, and planning the best listing path."
                },
                {
                    "title": "Mergers & Acquisitions",
                    "desc": "Identifying potential buyers or targets, conducting due diligence, designing transaction structures to maximize enterprise value."
                },
                {
                    "title": "Corporate Finance",
                    "desc": "Optimizing capital structure, introducing strategic investors, providing professional advice on debt and equity financing."
                },
                {
                    "title": "Corporate Structuring",
                    "desc": "Designing compliant and efficient equity structures to lay a solid foundation for future financing, listing, or family succession."
                },
                {
                    "title": "Operations Management",
                    "desc": "Enhancing operational efficiency, establishing internal control systems to ensure business processes meet best industry standards."
                }
            ]
        },
        "consultants": {
            "title": "Consultant Team",
            "subtitle": "Senior Industry Experts",
            "items": [
                {
                    "name": "David Chan",
                    "role": "Senior IPO Consultant / Partner",
                    "desc": "Over 20 years of capital market experience, led multiple HK Main Board listing projects, proficient in listing rules and regulatory requirements."
                },
                {
                    "name": "Grace Lam",
                    "role": "M&A Director",
                    "desc": "Focusing on cross-border M&A and corporate restructuring, successfully facilitated multiple high-value commercial transactions, creating significant value for clients."
                },
                {
                    "name": "Peter Zhang",
                    "role": "Corporate Finance Consultant",
                    "desc": "Expert in designing financing solutions for enterprises, maintaining good relationships with banks and investment institutions to assist companies in solving funding needs."
                },
                {
                    "name": "Michelle Wong",
                    "role": "Operations Management Expert",
                    "desc": "Extensive experience in corporate operations management, dedicated to improving corporate efficiency and establishing sound internal control systems."
                }
            ]
        },
        "cta": {
            "title": "Ready to Accelerate Your Growth?",
            "subtitle": "Let's discuss how to help your business reach its potential and achieve capital market goals",
            "button": "Contact Us"
        },
        "form": {
            "title": "Book Consultation",
            "name": "Name",
            "company": "Company Name",
            "email": "Email Address",
            "phone": "Phone Number",
            "message": "Message",
            "submit": "Submit Request",
            "cancel": "Cancel"
        },
        "footer": {
            "company_name": "GLOBAL LINK",
            "company_suffix": "STRATEGY LIMITED",
            "desc": "Being an unrivaled market-leading catalyst, redefining development trajectories by unlocking the liquidity of high-potential enterprises, establishing them as industry leaders. We envision a business landscape where our strategic interventions turn ambitions into tangible capital market success...",
            "services_title": "Services",
            "contact_title": "Contact Us",
            "address": "Unit 01B3, 23/F, Nan Fung Centre, 264-298 Castle Peak Road, Tsuen Wan, Hong Kong",
            "copyright": "© 2026 Global Link Strategy Limited · All Rights Reserved",
            "privacy": "Privacy Policy",
            "terms": "Terms of Service"
        }
    },
    'zh-tw': {
        "meta": {
            "title": "Global Link Strategy - 您的資本市場成功夥伴",
            "description": "專業的上市諮詢、併購與企業融資服務。"
        },
        "nav": {
            "home": "首頁",
            "services": "服務",
            "consultants": "顧問團隊",
            "about": "關於我們",
            "contact": "聯繫我們",
            "logo_alt": "匯通環球策略有限公司 Logo"
        },
        "hero": {
            "title_cn": "匯通環球策略有限公司",
            "title_en": "GLOBAL LINK STRATEGY LIMITED",
            "subtitle": "您的資本市場成功夥伴 | 上市諮詢 | 企業融資",
            "cta": "立即諮詢"
        },
        "services": {
            "title": "專業服務",
            "subtitle": "全方位的資本市場解決方案",
            "items": [
                {
                    "title": "上市諮詢",
                    "desc": "提供全程IPO輔導，協助企業符合香港交易所上市要求，規劃最佳上市路徑。"
                },
                {
                    "title": "併購與收購",
                    "desc": "尋找潛在買家或標的，進行盡職調查，設計交易結構，實現企業價值最大化。"
                },
                {
                    "title": "企業融資",
                    "desc": "優化資本結構，引入戰略投資者，提供債權融資及股權融資的專業建議。"
                },
                {
                    "title": "企業結構設計",
                    "desc": "設計合規且高效的股權架構，為未來融資、上市或家族傳承奠定堅實基礎。"
                },
                {
                    "title": "營運管理",
                    "desc": "提升企業營運效率，建立內部控制系統，確保業務流程符合最佳行業標準。"
                }
            ]
        },
        "consultants": {
            "title": "顧問團隊",
            "subtitle": "資深行業專家",
            "items": [
                {
                    "name": "陳偉明 (David Chan)",
                    "role": "資深上市顧問 / 合夥人",
                    "desc": "擁有20年以上的資本市場經驗，曾主導多個香港主板上市項目，精通上市規則及監管要求。"
                },
                {
                    "name": "林雅詩 (Grace Lam)",
                    "role": "併購總監",
                    "desc": "專注於跨國併購與企業重組，成功促成多宗高價值的商業交易，為客戶創造顯著價值。"
                },
                {
                    "name": "張志強 (Peter Zhang)",
                    "role": "企業融資顧問",
                    "desc": "擅長為企業設計融資方案，與多家銀行及投資機構保持良好關係，協助企業解決資金需求。"
                },
                {
                    "name": "黃美玲 (Michelle Wong)",
                    "role": "營運管理專家",
                    "desc": "具備豐富的企業營運管理經驗，致力於提升企業效率及建立完善的內部控制體系。"
                }
            ]
        },
        "cta": {
            "title": "準備加速您的增長？",
            "subtitle": "讓我們討論如何幫助您的業務發揮潛力並實現資本市場目標",
            "button": "聯繫我們"
        },
        "form": {
            "title": "立即諮詢",
            "name": "姓名",
            "company": "公司名稱",
            "email": "電子郵件",
            "phone": "聯絡電話",
            "message": "留言內容",
            "submit": "提交諮詢",
            "cancel": "取消"
        },
        "footer": {
            "company_name": "GLOBAL LINK",
            "company_suffix": "STRATEGY LIMITED",
            "desc": "成為無可匹敵的市場主導催化劑，通過釋放高潛力企業的流動性，重新定義其發展軌跡，將其建立為行業龍頭。我們憧憬一個商業格局，其中我們的戰略干預將雄心壯志轉化為切實可行的資本市場成功，確立我們的公司為該地區...",
            "services_title": "服務",
            "contact_title": "聯繫我們",
            "address": "荃灣青山道264-298號南豐中心23樓01B3室",
            "copyright": "© 2026 匯通環球策略有限公司 · 版權所有",
            "privacy": "私隱政策",
            "terms": "服務條款"
        }
    },
    'zh-cn': {
        "meta": {
            "title": "Global Link Strategy - 您的资本市场成功伙伴",
            "description": "专业的上市咨询、并购与企业融资服务。"
        },
        "nav": {
            "home": "首页",
            "services": "服务",
            "consultants": "顾问团队",
            "about": "关于我们",
            "contact": "联系我们",
            "logo_alt": "汇通环球策略有限公司 Logo"
        },
        "hero": {
            "title_cn": "汇通环球策略有限公司",
            "title_en": "GLOBAL LINK STRATEGY LIMITED",
            "subtitle": "您的资本市场成功伙伴 | 上市咨询 | 企业融资",
            "cta": "立即咨询"
        },
        "services": {
            "title": "专业服务",
            "subtitle": "全方位的资本市场解决方案",
            "items": [
                {
                    "title": "上市咨询",
                    "desc": "提供全程IPO辅导，协助企业符合香港交易所上市要求，规划最佳上市路径。"
                },
                {
                    "title": "并购与收购",
                    "desc": "寻找潜在买家或标的，进行尽职调查，设计交易结构，实现企业价值最大化。"
                },
                {
                    "title": "企业融资",
                    "desc": "优化资本结构，引入战略投资者，提供债权融资及股权融资的专业建议。"
                },
                {
                    "title": "企业结构设计",
                    "desc": "设计合规且高效的股权架构，为未来融资、上市或家族传承奠定坚实基础。"
                },
                {
                    "title": "营运管理",
                    "desc": "提升企业营运效率，建立内部控制系统，确保业务流程符合最佳行业标准。"
                }
            ]
        },
        "consultants": {
            "title": "顾问团队",
            "subtitle": "资深行业专家",
            "items": [
                {
                    "name": "陈伟明 (David Chan)",
                    "role": "资深上市顾问 / 合伙人",
                    "desc": "拥有20年以上的资本市场经验，曾主导多个香港主板上市项目，精通上市规则及监管要求。"
                },
                {
                    "name": "林雅诗 (Grace Lam)",
                    "role": "并购总监",
                    "desc": "专注于跨国并购与企业重组，成功促成多宗高价值的商业交易，为客户创造显著价值。"
                },
                {
                    "name": "张志强 (Peter Zhang)",
                    "role": "企业融资顾问",
                    "desc": "擅长为企业设计融资方案，与多家银行及投资机构保持良好关系，协助企业解决资金需求。"
                },
                {
                    "name": "黄美玲 (Michelle Wong)",
                    "role": "营运管理专家",
                    "desc": "具备丰富的企业营运管理经验，致力于提升企业效率及建立完善的内部控制体系。"
                }
            ]
        },
        "cta": {
            "title": "准备加速您的增长？",
            "subtitle": "让我们讨论如何帮助您的业务发挥潜力并实现资本市场目标",
            "button": "联系我们"
        },
        "form": {
            "title": "立即咨询",
            "name": "姓名",
            "company": "公司名称",
            "email": "电子邮件",
            "phone": "联系电话",
            "message": "留言内容",
            "submit": "提交咨询",
            "cancel": "取消"
        },
        "footer": {
            "company_name": "GLOBAL LINK",
            "company_suffix": "STRATEGY LIMITED",
            "desc": "成为无可匹敌的市场主导催化剂，通过释放高潜力企业的流动性，重新定义其发展轨迹，将其建立为行业龙头。我们憧憬一个商业格局，其中我们的战略干预将雄心壮志转化为切实可行的资本市场成功，确立我们的公司为该地区...",
            "services_title": "服务",
            "contact_title": "联系我们",
            "address": "荃湾青山道264-298号南丰中心23楼01B3室",
            "copyright": "© 2026 汇通环球策略有限公司 · 版权所有",
            "privacy": "私隐政策",
            "terms": "服务条款"
        }
    }
};

class I18n {
    constructor() {
        this.currentLang = localStorage.getItem('lang') || 'zh-tw';
        this.translations = {};
        this.elements = document.querySelectorAll('[data-i18n]');
        this.init();
    }

    init() {
        this.setupLanguageSelector();
        
        // Define changeLanguage globally immediately
        window.changeLanguage = (lang) => this.loadLanguage(lang);

        this.loadLanguage(this.currentLang);
    }

    setupLanguageSelector() {
        const selector = document.getElementById('current-lang');
        if (selector) {
            const names = {
                'en': 'English',
                'zh-tw': '繁體中文',
                'zh-cn': '简体中文'
            };
            selector.textContent = names[this.currentLang] || names['zh-tw'];
        }
    }

    loadLanguage(lang) {
        try {
            // Use static locales object instead of fetch
            const translations = locales[lang];
            if (!translations) {
                console.error(`Language ${lang} not found, falling back to zh-tw`);
                this.loadLanguage('zh-tw');
                return;
            }

            this.translations = translations;
            this.currentLang = lang;
            localStorage.setItem('lang', lang);
            
            // Update DOM
            this.updatePage();
            this.updateLanguageSelector(lang);
            this.updateMeta(lang);
            
            // Dispatch event
            document.dispatchEvent(new CustomEvent('languageChanged', { detail: { lang } }));
            
        } catch (error) {
            console.error('Error loading language:', error);
        }
    }

    updatePage() {
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            const value = this.getNestedValue(this.translations, key);
            
            if (value) {
                if (element.tagName === 'IMG' && element.hasAttribute('data-i18n-img')) {
                    // Handle image replacement if needed, or just alt
                    element.alt = value; 
                } else if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                    element.placeholder = value;
                } else {
                    // Handle HTML content if needed, or just text
                    if (element.hasAttribute('data-i18n-html')) {
                        element.innerHTML = value;
                    } else {
                        element.textContent = value;
                    }
                }
            }
        });
    }

    updateLanguageSelector(lang) {
        const selector = document.getElementById('current-lang');
        const names = {
            'en': 'English',
            'zh-tw': '繁體中文',
            'zh-cn': '简体中文'
        };
        if (selector) selector.textContent = names[lang];
        document.documentElement.lang = lang;
    }

    updateMeta(lang) {
        // Update Title
        if (this.translations.meta && this.translations.meta.title) {
            document.title = this.translations.meta.title;
        }
        // Update Description
        const metaDesc = document.querySelector('meta[name="description"]');
        if (metaDesc && this.translations.meta && this.translations.meta.description) {
            metaDesc.setAttribute('content', this.translations.meta.description);
        }
    }

    getNestedValue(obj, path) {
        return path.split('.').reduce((prev, curr) => {
            return prev ? prev[curr] : null;
        }, obj);
    }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    window.i18nApp = new I18n();
    
    // Lazy Loading Fallback
    const images = document.querySelectorAll('img[loading="lazy"]');
    images.forEach(img => {
        img.onerror = function() {
            // Optional: fallback logic
            // this.src = 'assets/images/placeholder.png'; 
            console.warn('Image failed to load:', this.src);
        };
    });
});
